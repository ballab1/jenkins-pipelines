
@Library('jenkins-sharedlibs')_

processInParallel (
    agent: 'master',
    items: activeNodes(),
    process: { nodeName, body -> 
        nodeStep(nodeName, body)
    },
    action: { nodeName ->
        sh './checkMounted.sh /mnt/ubuntu'
        loadIfExists './status.groovy'

        sh "./backup.sh '${nodeName}'"
        loadIfExists './status.groovy'
        archiveArtifacts allowEmptyArchive: true, artifacts: '*.log,*.tgz'
    }
)
