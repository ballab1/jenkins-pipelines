
@Library('jenkins-sharedlibs')_

processInParallel (
    agent: 'master',
    items: activeNodes(),
    process: { nodeName, body -> 
        nodeStep(nodeName, body)
    },
    action: { nodeName ->
        def tarfile = nodeName + '.cfg.tgz'
        sh "sudo tar -cvzf ${tarfile} -T ./tarfiles.lst ||:"
        sh "./backup.sh '${WORKSPACE}/${tarfile}'"
        archiveArtifacts tarfile
    }
)