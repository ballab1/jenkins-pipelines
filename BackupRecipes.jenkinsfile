
@Library('jenkins-sharedlibs')_

processInParallel (
    agent: 'ubuntu-s3',
    items: [ 'recipes.tgz' ],
    process: { tarfile, body -> 
        fixedNodeStep(tarfile, body)
    },
    action: { tarfile ->
        sh "cd /home/bobb/production/workspace.production/www/recipes; tar czf '${WORKSPACE}/${tarfile}' * ||:"
        sh "./backup.sh '${WORKSPACE}/${tarfile}'"
        script {
            load './status.groovy'
        } 
        archiveArtifacts tarfile
    }
)